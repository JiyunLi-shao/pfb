// See LICENSE for license details.

package pfb

/**
  * See [[https://en.wikipedia.org/wiki/Window_function#Blackman.E2.80.93Harris_window the wikipedia page]] for
  * more details
  */
object blackmanHarris {
  private val a0 = 0.35875
  private val a1 = 0.48829
  private val a2 = 0.14128
  private val a3 = 0.01168
  def apply(N: Int): Seq[Double] = Seq.tabulate(N) (i => {
    a0 -
      a1 * math.cos(2 * math.Pi * i.toDouble / (N - 1)) +
      a2 * math.cos(4 * math.Pi * i.toDouble / (N - 1)) -
      a3 * math.cos(6 * math.Pi * i.toDouble / (N - 1))
  })
  def apply(w: WindowConfig): Seq[Double] = blackmanHarris(w.outputWindowSize * w.numTaps)
}

/**
  * Copied (erroneously?) from SPLASH
  */
object sincHamming {
  def apply(size: Int, nfft: Int): Seq[Double] = Seq.tabulate(size) (i=>{
    val term1 = 0.54 - 0.46 * breeze.numerics.cos(2 * scala.math.Pi * i.toDouble / size)
    val term2 = breeze.numerics.sinc(size.toDouble / nfft - 0.5 * (size.toDouble / nfft) )
    term1 * term2
  })
  def apply(w: WindowConfig): Seq[Double] = sincHamming(w.outputWindowSize * w.numTaps, w.outputWindowSize)
}


object userCoeff {

  def apply(coeff1: Double, frbits: Double): Seq[Double] = {
   val coeff1 = Array(
        120,   -4,   -4,   -4,   -4,   -4,   -4,   -4,   -4,   -4,   -4,
         -4,   -4,   -4,   -4,   -4,   -4,   -4,   -4,   -4,   -4,   -4,
         -4,   -4,   -4,   -5,   -5,   -5,   -5,   -5,   -5,   -5,   -5,
         -5,   -5,   -5,   -5,   -6,   -6,   -6,   -6,   -6,   -6,   -6,
         -6,   -6,   -6,   -6,   -7,   -7,   -7,   -7,   -7,   -7,   -7,
         -7,   -7,   -7,   -7,   -8,   -8,   -8,   -8,   -8,   -8,   -8,
         -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,
         -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,   -8,
         -8,   -8,   -8,   -8,   -8,   -7,   -7,   -7,   -7,   -7,   -7,
         -7,   -7,   -6,   -6,   -6,   -6,   -6,   -6,   -5,   -5,   -5,
         -5,   -5,   -4,   -4,   -4,   -4,   -3,   -3,   -3,   -3,   -2,
         -2,   -2,   -2,   -1,   -1,   -1,    0,    0,    0,    1,    1,
          1,    2,    2,    2,    3,    3,    3,    4,    4,    4,    5,
          5,    6,    6,    6,    7,    7,    7,    8,    8,    9,    9,
          9,   10,   10,   11,   11,   11,   12,   12,   12,   13,   13,
         13,   14,   14,   14,   15,   15,   15,   16,   16,   16,   17,
         17,   17,   18,   18,   18,   18,   19,   19,   19,   19,   20,
         20,   20,   20,   20,   20,   21,   21,   21,   21,   21,   21,
         21,   21,   21,   21,   21,   21,   21,   21,   21,   21,   21,
         21,   21,   21,   21,   21,   20,   20,   20,   20,   20,   19,
         19,   19,   19,   18,   18,   18,   17,   17,   16,   16,   16,
         15,   15,   14,   14,   13,   13,   12,   12,   11,   11,   10,
          9,    9,    8,    8,    7,    6,    6,    5,    4,    4,    3,
          2,    1,    1,    0,   -1,   -2,   -2,   -3,   -4,   -5,   -6,
         -7,   -7,   -8,   -9,  -10,  -11,  -12,  -12,  -13,  -14,  -15,
        -16,  -17,  -18,  -18,  -19,  -20,  -21,  -22,  -23,  -24,  -24,
        -25,  -26,  -27,  -28,  -28,  -29,  -30,  -31,  -32,  -32,  -33,
        -34,  -34,  -35,  -36,  -37,  -37,  -38,  -38,  -39,  -40,  -40,
        -41,  -41,  -42,  -42,  -43,  -43,  -44,  -44,  -44,  -45,  -45,
        -45,  -45,  -46,  -46,  -46,  -46,  -46,  -46,  -47,  -47,  -47,
        -47,  -47,  -46,  -46,  -46,  -46,  -46,  -46,  -45,  -45,  -45,
        -44,  -44,  -44,  -43,  -43,  -42,  -42,  -41,  -40,  -40,  -39,
        -38,  -37,  -37,  -36,  -35,  -34,  -33,  -32,  -31,  -30,  -29,
        -28,  -27,  -26,  -25,  -24,  -22,  -21,  -20,  -19,  -17,  -16,
        -14,  -13,  -12,  -10,   -9,   -7,   -6,   -4,   -3,   -1,    0,
          2,    4,    5,    7,    9,   10,   12,   14,   15,   17,   19,
         21,   22,   24,   26,   28,   29,   31,   33,   35,   36,   38,
         40,   42,   43,   45,   47,   48,   50,   52,   53,   55,   57,
         58,   60,   61,   63,   64,   66,   67,   69,   70,   72,   73,
         74,   76,   77,   78,   79,   80,   81,   82,   83,   84,   85,
         86,   87,   88,   89,   89,   90,   91,   91,   92,   92,   93,
         93,   93,   93,   94,   94,   94,   94,   94,   94,   93,   93,
         93,   93,   92,   92,   91,   90,   90,   89,   88,   87,   86,
         85,   84,   83,   82,   81,   79,   78,   77,   75,   73,   72,
         70,   68,   66,   64,   63,   61,   58,   56,   54,   52,   49,
         47,   45,   42,   40,   37,   34,   32,   29,   26,   23,   20,
         17,   14,   11,    8,    5,    2,   -1,   -4,   -8,  -11,  -14,
        -18,  -21,  -25,  -28,  -31,  -35,  -38,  -42,  -45,  -49,  -52,
        -56,  -60,  -63,  -67,  -70,  -74,  -77,  -81,  -85,  -88,  -92,
        -95,  -99, -102, -106, -109, -112, -116, -119, -122, -126, -129,
       -132, -135, -138, -141, -144, -147, -150, -153, -156, -158, -161,
       -164, -166, -168, -171, -173, -175, -177, -179, -181, -183, -185,
       -187, -188, -190, -191, -192, -193, -194, -195, -196, -197, -197,
       -198, -198, -199, -199, -199, -199, -198, -198, -197, -197, -196,
       -195, -194, -193, -192, -190, -189, -187, -185, -183, -181, -178,
       -176, -173, -171, -168, -165, -161, -158, -155, -151, -147, -143,
       -139, -135, -130, -126, -121, -116, -111, -106, -101,  -96,  -90,
        -84,  -78,  -72,  -66,  -60,  -53,  -47,  -40,  -33,  -26,  -19,
        -12,   -4,    3,   11,   19,   27,   35,   43,   51,   60,   68,
         77,   86,   95,  104,  113,  122,  131,  141,  150,  160,  170,
        179,  189,  199,  209,  219,  229,  240,  250,  260,  271,  281,
        292,  302,  313,  324,  334,  345,  356,  367,  378,  389,  400,
        410,  421,  432,  443,  454,  465,  476,  487,  498,  509,  520,
        530,  541,  552,  563,  573,  584,  595,  605,  616,  626,  637,
        647,  657,  667,  677,  687,  697,  707,  717,  727,  736,  746,
        755,  764,  773,  782,  791,  800,  808,  817,  825,  834,  842,
        850,  857,  865,  872,  880,  887,  894,  901,  908,  914,  920,
        927,  933,  938,  944,  950,  955,  960,  965,  970,  974,  978,
        983,  986,  990,  994,  997, 1000, 1003, 1006, 1008, 1011, 1013,
       1015, 1016, 1018, 1019, 1020, 1021, 1022, 1022, 1022, 1022, 1022,
       1022, 1021, 1020, 1019, 1018, 1016, 1015, 1013, 1011, 1008, 1006,
       1003, 1000,  997,  994,  990,  986,  983,  978,  974,  970,  965,
        960,  955,  950,  944,  938,  933,  927,  920,  914,  908,  901,
        894,  887,  880,  872,  865,  857,  850,  842,  834,  825,  817,
        808,  800,  791,  782,  773,  764,  755,  746,  736,  727,  717,
        707,  697,  687,  677,  667,  657,  647,  637,  626,  616,  605,
        595,  584,  573,  563,  552,  541,  530,  520,  509,  498,  487,
        476,  465,  454,  443,  432,  421,  410,  400,  389,  378,  367,
        356,  345,  334,  324,  313,  302,  292,  281,  271,  260,  250,
        240,  229,  219,  209,  199,  189,  179,  170,  160,  150,  141,
        131,  122,  113,  104,   95,   86,   77,   68,   60,   51,   43,
         35,   27,   19,   11,    3,   -4,  -12,  -19,  -26,  -33,  -40,
        -47,  -53,  -60,  -66,  -72,  -78,  -84,  -90,  -96, -101, -106,
       -111, -116, -121, -126, -130, -135, -139, -143, -147, -151, -155,
       -158, -161, -165, -168, -171, -173, -176, -178, -181, -183, -185,
       -187, -189, -190, -192, -193, -194, -195, -196, -197, -197, -198,
       -198, -199, -199, -199, -199, -198, -198, -197, -197, -196, -195,
       -194, -193, -192, -191, -190, -188, -187, -185, -183, -181, -179,
       -177, -175, -173, -171, -168, -166, -164, -161, -158, -156, -153,
       -150, -147, -144, -141, -138, -135, -132, -129, -126, -122, -119,
       -116, -112, -109, -106, -102,  -99,  -95,  -92,  -88,  -85,
       -81, -77, -74, -70, -67, -63, -60, -56, -52, -49, -45, -42, -38,
       -35, -31, -28, -25, -21, -18, -14, -11,  -8,  -4,  -1,   2,   5,
         8,  11,  14,  17,  20,  23,  26,  29,  32,  34,  37,  40,  42,
        45,  47,  49,  52,  54,  56,  58,  61,  63,  64,  66,  68,  70,
        72,  73,  75,  77,  78,  79,  81,  82,  83,  84,  85,  86,  87,
        88,  89,  90,  90,  91,  92,  92,  93,  93,  93,  93,  94,  94,
        94,  94,  94,  94,  93,  93,  93,  93,  92,  92,  91,  91,  90,
        89,  89,  88,  87,  86,  85,  84,  83,  82,  81,  80,  79,  78,
        77,  76,  74,  73,  72,  70,  69,  67,  66,  64,  63,  61,  60,
        58,  57,  55,  53,  52,  50,  48,  47,  45,  43,  42,  40,  38,
        36,  35,  33,  31,  29,  28,  26,  24,  22,  21,  19,  17,  15,
        14,  12,  10,   9,   7,   5,   4,   2,   0,  -1,  -3,  -4,  -6,
        -7,  -9, -10, -12, -13, -14, -16, -17, -19, -20, -21, -22, -24,
       -25, -26, -27, -28, -29, -30, -31, -32, -33, -34, -35, -36, -37,
       -37, -38, -39, -40, -40, -41, -42, -42, -43, -43, -44, -44, -44,
       -45, -45, -45, -46, -46, -46, -46, -46, -46, -47, -47, -47, -47,
       -47, -46, -46, -46, -46, -46, -46, -45, -45, -45, -45, -44, -44,
       -44, -43, -43, -42, -42, -41, -41, -40, -40, -39, -38, -38, -37,
       -37, -36, -35, -34, -34, -33, -32, -32, -31, -30, -29, -28, -28,
       -27, -26, -25, -24, -24, -23, -22, -21, -20, -19, -18, -18, -17,
       -16, -15, -14, -13, -12, -12, -11, -10,  -9,  -8,  -7,  -7,  -6,
        -5,  -4,  -3,  -2,  -2,  -1,   0,   1,   1,   2,   3,   4,   4,
         5,   6,   6,   7,   8,   8,   9,   9,  10,  11,  11,  12,  12,
        13,  13,  14,  14,  15,  15,  16,  16,  16,  17,  17,  18,  18,
        18,  19,  19,  19,  19,  20,  20,  20,  20,  20,  21,  21,  21,
        21,  21,  21,  21,  21,  21,  21,  21,  21,  21,  21,  21,  21,
        21,  21,  21,  21,  21,  21,  20,  20,  20,  20,  20,  20,  19,
        19,  19,  19,  18,  18,  18,  18,  17,  17,  17,  16,  16,  16,
        15,  15,  15,  14,  14,  14,  13,  13,  13,  12,  12,  12,  11,
        11,  11,  10,  10,   9,   9,   9,   8,   8,   7,   7,   7,   6,
         6,   6,   5,   5,   4,   4,   4,   3,   3,   3,   2,   2,   2,
         1,   1,   1,   0,   0,   0,  -1,  -1,  -1,  -2,  -2,  -2,  -2,
        -3,  -3,  -3,  -3,  -4,  -4,  -4,  -4,  -5,  -5,  -5,  -5,  -5,
        -6,  -6,  -6,  -6,  -6,  -6,  -7,  -7,  -7,  -7,  -7,  -7,  -7,
        -7,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,
        -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,
        -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -8,  -7,  -7,  -7,  -7,
        -7,  -7,  -7,  -7,  -7,  -7,  -7,  -6,  -6,  -6,  -6,  -6,  -6,
        -6,  -6,  -6,  -6,  -6,  -5,  -5,  -5,  -5,  -5,  -5,  -5,  -5,
        -5,  -5,  -5,  -5,  -4,  -4,  -4,  -4,  -4,  -4,  -4,  -4,  -4,
        -4,  -4,  -4,  -4,  -4,-4.0,  -4,  -4,  -4,  -4,  -4,  -4,  -4,
        -4,  -4, 120)
   val frbits = math.pow(2,17)
   val result = coeff1.map(_ / frbits )
   result
  }
  def apply(w: WindowConfig): Seq[Double] = userCoeff(w.outputWindowSize * w.numTaps, w.outputWindowSize)
}

